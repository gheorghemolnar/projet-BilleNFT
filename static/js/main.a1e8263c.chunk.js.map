{"version":3,"sources":["contexts/EthContext/EthContext.js","contexts/EthContext/state.js","utils/index.js","contexts/EthContext/EthProvider.jsx","contexts/EthContext/useEth.js","components/Navbar/index.jsx","components/Menu/index.jsx","components/NoticeNoArtifact.jsx","components/NoticeWrongNetwork.jsx","components/Listing/index.jsx","components/ListingTickets/index.jsx","components/common/index.jsx","components/FormEvent/index.jsx","components/ViewEvent/index.jsx","components/FormTicket/index.jsx","components/NoMatch/index.jsx","App.jsx","index.js"],"names":["EthContext","createContext","actions","initialState","artifact","web3","accounts","networkID","contract","contractBilleEvent","eventsCreated","ticketsSold","owner","handleDispatch","reducer","state","action","type","data","evCreate","evTicketSold","Error","TICKET_PRICE","TICKET_CATEGORIES","TICKET_CATEGORIES_LABELS","getContractStoreByAddress","abi","address","eth","Contract","getContractEventByAddress","BilleEventABI","getContractCommByAddress","CommunicationABI","getDateFromTimestamp","date","Intl","DateTimeFormat","year","month","day","format","formatAmount","amount","unit","utils","fromWei","isOwner","currentUser","length","EthProvider","children","useReducer","dispatch","init","useCallback","Web3","givenProvider","requestAccounts","net","getId","initEvents","initTicketsSold","initOwner","networks","contractBilleStore","contractCommunication","options","fromBlock","toBlock","Promise","all","methods","call","getPastEvents","console","error","useEffect","tryInit","require","err","events","handleChange","eventsSubscriptions","options1","subEvCreate","EventCreated","on","event","log","subTicketSold","TicketSold","forEach","e","window","ethereum","removeListener","Object","entries","key","subsription","unsubscribe","Provider","value","useEth","useContext","Navbar","className","id","href","src","alt","width","height","fill","Home","isActive","to","NoticeNoArtifact","NoticeWrongNetwork","Listing","isAdmin","eventContent","map","returnValues","eventAddress","name","description","uri","dateEve","imageSrc","split","xmlns","role","preserveAspectRatio","focusable","x","y","dy","ListingTickets","myTickets","filter","myEventIds","idEvent","myEventsInfos","reduce","acc","includes","category","idTicket","quantity","NavToHome","FormEvent","navigate","useNavigate","useForm","register","handleSubmit","useState","isLoading","setIsLoading","fileImg","setFileImg","onSubmit","nameEvent","sendFileToIPFS","cidImage","newData","handleCreateEvent","params","dateEvent","symbol","ticketSupply1","ticketSupply2","ticketSupply3","dateTimestamp","Number","Date","createEvent","send","from","eventName","timestamp","now","fileName","filePath","formData","FormData","append","axios","method","url","headers","process","resFile","IpfsHash","htmlFor","onChange","target","files","defaultValue","ViewEvent","setContractBilleEvent","balance","ticketsStats","stats","setStats","useParams","showEventStats","contractEvent","fetchData","getEventStats","ticketsStatsObject","values","slice","tickets","eventStats","eventStatsTickets","eventInfos","currentEvent","i","placeholder","disabled","dotenv","config","errlist","setErrlist","errMessage","setErrMessage","ticketOrder","setTicketOrder","tmp","getBalance","inputValue","addedTicketOrder","parseInt","handleTicketBuy","price","toWei","buyTickets","gas","preventDefault","stopPropagation","schema","Joi","object","number","min","max","required","joiResponse","validate","abortEarly","details","totalPrice","message","forhtml","checked","NoMatch","App","routes","path","element","Layout","index","useRoutes","ReactDOM","createRoot","document","getElementById","render","StrictMode"],"mappings":"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","file":"static/js/main.a1e8263c.chunk.js","sourcesContent":["import { createContext } from \"react\";\n\nconst EthContext = createContext();\n\nexport default EthContext;\n","const actions = {\n  INIT: \"INIT\",  \n  EVENT_CREATED: \"EVENT_CREATED\",\n  TICKET_SOLD: \"TICKET_SOLD\"\n};\n\nconst initialState = {\n  artifact: null,\n  web3: null,\n  accounts: [],\n  networkID: '',\n  contract: null,\n  contractBilleEvent: null,\n  eventsCreated: [],\n  ticketsSold: [],\n  owner: false,\n  handleDispatch: () => {}\n};\n\nconst reducer = (state, action) => {\n  const { type, data } = action;\n  switch (type) {\n    case actions.INIT:\n      return { ...state, ...data };\n    case actions.EVENT_CREATED:\n        return {\n           ...state, \n           eventsCreated: [...state.eventsCreated, data.evCreate]\n          };\n    case actions.TICKET_SOLD:\n        return {\n            ...state,\n            ticketsSold: [...state.ticketsSold, data.evTicketSold]\n          };\n    default:\n      throw new Error(\"Undefined reducer action type\");\n  }\n};\n\nexport {\n  actions,\n  initialState,\n  reducer\n};\n","import BilleEventABI from \"../contracts/BilleEvent.json\";\nimport CommunicationABI from \"../contracts/Communication.json\";\n\n\nexport const TICKET_PRICE = 0.02;\n\nexport const TICKET_CATEGORIES = [0, 1, 2];\nexport const TICKET_CATEGORIES_LABELS = ['Fosse', 'Gradins', 'VIP'];\n\nexport const getStatsAsObject = (arrValues) => {\n    const result = {sales: [], supplies: []};\n\n    for (let i = 0; i<TICKET_CATEGORIES.length; i++) {\n        result['sales'].push(arrValues[i]);\n        result['supplies'].push(arrValues[i+3]);\n    }\n\n    return result;\n}\n\nexport const getContractStoreByAddress = (web3, abi, address) => {\n    const contract = new web3.eth.Contract(abi, address);\n    return contract;\n}\n\nexport const getContractEventByAddress = (web3, address) => {\n    const contract = new web3.eth.Contract(BilleEventABI.abi, address);\n    return contract;\n}\n\nexport const getContractCommByAddress = (web3, address) => {\n    const contract = new web3.eth.Contract(CommunicationABI.abi, address);\n    return contract;\n}\n\nexport const getDateFromTimestamp = (date) => {\n    const dateEvent = Intl.DateTimeFormat('fr-FR', { year: 'numeric', month: '2-digit', day: '2-digit' }).format(date);\n    return dateEvent;\n}\n\n// Conversions\nexport const formatAmount = (amount, web3, unit = 'ether') => web3 ? `${web3.utils.fromWei(amount, unit)} Eth`: '0 Eth';\n\n// Is App Owner\nexport const isOwner = (currentUser, owner) => currentUser && currentUser.length > 0 ? currentUser[0] === owner : false;\n","import React, { useReducer, useCallback, useEffect } from \"react\";\nimport Web3 from \"web3\";\nimport EthContext from \"./EthContext\";\nimport { reducer, actions, initialState } from \"./state\";\nimport { getContractStoreByAddress, getContractEventByAddress, getContractCommByAddress } from '../../utils';\n\nfunction EthProvider({ children }) {\n  \n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  const init = useCallback(\n    async artifact => {\n      if (artifact) {\n        const web3 = new Web3(Web3.givenProvider || \"ws://localhost:8545\");\n        const accounts = await web3.eth.requestAccounts();\n        const networkID = await web3.eth.net.getId();\n        const { abi } = artifact;\n        let address, contractBilleStore, contractBilleEvent, contractCommunication;\n        let initEvents = [];\n        let initTicketsSold = [];\n\n        let initOwner = false;\n        try {\n          address = artifact.networks[networkID].address;\n          contractBilleStore = getContractStoreByAddress(web3, abi, address);\n          contractBilleEvent = getContractEventByAddress(web3, address);\n          contractCommunication = getContractCommByAddress(web3, address);\n          \n          // On recup tous les events passés du contrat\n          if(contractBilleStore && contractBilleEvent) {\n            const options = { fromBlock: 0, toBlock: 'latest' };\n\n            [initOwner, initEvents ] = await Promise.all([\n              contractBilleStore.methods.owner().call(),\n              contractBilleStore.getPastEvents('EventCreated', options)\n            ]);\n\n\n          }\n        } catch (err) {\n          console.error(err);\n        }\n        \n        dispatch({\n          type: actions.INIT,\n          data: { artifact, web3, accounts, networkID, \n            owner: initOwner, contractBilleStore, \n            contractBilleEvent, contractCommunication, \n            eventsCreated: [...initEvents], ticketsSold: [...initTicketsSold],\n            handleDispatch: dispatch\n          }\n        });\n      }\n    }, []);\n    \n\n  useEffect(() => {\n    const tryInit = async () => {\n      try {\n        const artifact = require(\"../../contracts/BilleStore.json\");\n        init(artifact);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    tryInit();\n  }, [init]);\n\n  useEffect(() => {\n    const events = [\"chainChanged\", \"accountsChanged\"];\n    const handleChange = () => {\n      init(state.artifact);\n    };\n\n    const eventsSubscriptions = {};\n    const options1 = {fromBlock: 'latest'};\n\n    if(state.contractBilleStore) {\n      const subEvCreate = state.contractBilleStore.events.EventCreated(options1)\n      .on('connected', event => {\n        console.log(\"Les détails de l'évènement sont connu\", event);\n      })\n      .on('data', event => {\n        dispatch({\n          type: actions.EVENT_CREATED,\n          data: {\n            evCreate: event\n          }\n        })\n      });\n      // add subscription for Events\n      eventsSubscriptions['eventCreated'] = subEvCreate;\n    }\n\n    if(state.contractBilleEvent) {\n      const subTicketSold = state.contractBilleEvent.events.TicketSold(options1)\n      .on('connected', event => {\n        console.log(\"Les détails de l'évènement sont connu\", event);\n      })\n      .on('data', event => {\n        dispatch({\n          type: actions.TICKET_SOLD,\n          data: {\n            evTicketSold: event\n          }\n        })\n      });\n      // add subscription for Tickets\n      eventsSubscriptions['ticketSold'] = subTicketSold;\n    }\n\n    events.forEach(e => window.ethereum.on(e, handleChange));\n    return () => {\n      events.forEach(e => window.ethereum.removeListener(e, handleChange));\n      Object.entries(eventsSubscriptions).forEach(([key, subsription]) => {\n        console.log(\"Unsubscribe for \", key);\n        subsription.unsubscribe();\n      })\n    };\n  }, [init, state.artifact, state.contractBilleStore, state.contractBilleEvent]);\n\n  \n\n  return (\n    <EthContext.Provider value={{\n      state,\n      dispatch\n    }}>\n      {children}\n    </EthContext.Provider>\n  );\n}\n\nexport default EthProvider;\n","import { useContext } from \"react\";\nimport EthContext from \"./EthContext\";\n\nconst useEth = () => useContext(EthContext);\n\nexport default useEth;\n","import React from 'react';\n\nimport useEth from \"../../contexts/EthContext/useEth\";\n\nexport default function Navbar() {\n  const { state: { accounts } } = useEth();\n\n  return (\n    <header>\n      <div className=\"collapse bg-dark\" id=\"navbarHeader\">\n        <div className=\"container\">\n          <div className=\"row\">\n            <div className=\"col-sm-8 col-md-7 py-4\">          \n            </div>\n            <div className=\"col-sm-4 offset-md-1 py-4\">\n              <h4 className=\"text-white\">Contact</h4>\n              <ul className=\"list-unstyled\">\n                <li><a href=\"https://web3.corsica\" className=\"text-white\">Suivez nous sur Twitter</a></li>\n                <li><a href=\"https://web3.corsica\" className=\"text-white\">Mais aussi sur Facebook</a></li>\n                <li><a href=\"https://web3.corsica\" className=\"text-white\">Contactez nous</a></li>\n              </ul>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div className=\"navbar navbar-dark bg-dark shadow-sm\">\n        <div className=\"container\">\n          <a href=\"/\" className=\"navbar-brand d-flex align-items-center\">\n            <img src=\"https://web3.corsica/wp-content/uploads/2022/07/logo.png\" alt=\"logo\" width=\"211\" height=\"57\" fill=\"none\"></img>\n          </a>\n          <div className=\"center text-white\">Compte : { accounts[0] }</div>\n          <button className=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarHeader\" aria-controls=\"navbarHeader\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\n            <span className=\"navbar-toggler-icon\"></span>\n          </button>\n        </div>\n      </div>\n    </header>\n  )\n}\n  ","import { NavLink } from \"react-router-dom\";\n\nexport default function Home() {\n    return (\n        <nav className=\"navbar navbar-expand-lg bg-light\">\n            <div className=\"container-fluid\">\n                <div className=\"collapse navbar-collapse justify-content-center\" id=\"navbarNav\">\n                    <ul className=\"navbar-nav\">\n                        <li className=\"nav-item\">\n                            <NavLink \n                                className={({isActive}) => `nav-link ${isActive ?\"active\": \"\"}`}\n                                aria-current=\"page\" \n                                to=\"/\">Tous les événements\n                            </NavLink>\n                        </li>\n                        <li className=\"nav-item\">\n                            <NavLink \n                                className={({isActive}) => `nav-link ${isActive ?\"active\": \"\"}`}\n                                aria-current=\"page\" \n                                to=\"/mytickets\">Mes tickets\n                            </NavLink>\n                        </li>\n                    </ul>\n                </div>\n            </div>\n        </nav>\n    )\n}","import React from 'react';\n\nfunction NoticeNoArtifact() {\n  return (\n    <div className=\"container text-center\">\n      <div className=\"row  justify-content-center\">\n        <div className=\"col-5  align-self-center\">\n          <button type=\"button\" className=\"btn btn-info\">Afin d'utiliser notre site, veuillez vous connecter à MetaMask.</button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default NoticeNoArtifact;\n","import React from 'react';\n\nfunction NoticeWrongNetwork() {\n  return (\n    <div className=\"container text-center\">\n      <div className=\"row  justify-content-center\">\n        <div className=\"col-5  align-self-center\">\n        <button type=\"button\" className=\"btn btn-warning\">Veuillez vérifier le réseau sur lequel MetaMask est connecté</button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default NoticeWrongNetwork;\n","import React from 'react';\nimport { Link } from \"react-router-dom\";\n\nimport NoticeNoArtifact from \"../NoticeNoArtifact\";\nimport NoticeWrongNetwork from \"../NoticeWrongNetwork\";\nimport useEth from \"../../contexts/EthContext/useEth\";\nimport { getDateFromTimestamp, isOwner } from \"../../utils\";\n\nexport default function Listing() {\n  const { state: { artifact, contractBilleStore, eventsCreated, accounts, owner } } = useEth();\n\n  const isAdmin = isOwner(accounts, owner);\n  const eventHeader = <section key=\"header\" className=\"py-5 text-center container\">\n      <div className=\"row py-lg-5\">\n        <div className=\"col-lg-6 col-md-8 mx-auto\">\n          <h1 className=\"fw-light\">Liste des événements à venir</h1>\n          <p className=\"lead text-muted\">Vous souhaitez assister au concert de votre artiste préféré avec vos amis, offrir un billet de concert à l’un de vos proches, ou trouver la sortie idéale en amoureux.Avec BilleNFT vous n’aurez aucun mal à trouver en quelques clics un billet pour le concert de votre choix.</p>\n          <p>\n            {isAdmin && (<Link to=\"/events/add\" className=\"btn btn-primary\">Ajouter un événement</Link>)}\n          </p>\n        </div>\n      </div>\n    </section>;\n  \n  const eventList =\n    eventsCreated.map(({ returnValues }) => {\n      const { eventAddress, name, description, date, uri } = returnValues;\n      const dateEve = getDateFromTimestamp(date);\n      const imageSrc = uri !== '' ? `${uri.split('//')[1]}` : '';\nconsole.log(`🚀  imageSrc`, imageSrc);\n\n      return <div className=\"col-lg-6 p-3\" key={returnValues.id}>\n        <div className=\"card shadow-sm\">\n          {\n            imageSrc ? <img src={`https://gateway.pinata.cloud/ipfs/${uri.split('//')[1]}`} alt=\"eventImage\"/> : <svg className=\"bd-placeholder-img card-img-top\" width=\"100%\" height=\"225\" xmlns=\"http://www.w3.org/2000/svg\" role=\"img\" aria-label=\"Placeholder: Thumbnail\" preserveAspectRatio=\"xMidYMid slice\" focusable=\"false\"><title>Placeholder</title><rect width=\"100%\" height=\"100%\" fill=\"#55595c\" /><text x=\"50%\" y=\"50%\" fill=\"#eceeef\" dy=\".3em\">Thumbnail</text></svg>\n          }\n\n          <div className=\"card-body\">\n\n            <Link to={`/events/${eventAddress}`} >\n\n              <p className=\"card-text\">  {name} </p>\n              <p className=\"card-text\"> {description}</p>\n              <div className=\"d-flex justify-content-between align-items-center\">\n\n                <small className=\"text-muted\">{dateEve}</small>\n              </div>\n            </Link>\n          </div>\n        </div>\n      </div>\n    });\n  const eventContent = [eventHeader, eventList ];\n\n  return (\n    <main>\n      <section className=\"py-5 text-center container\">\n        <div className=\"row\">\n          {\n            !artifact ? <NoticeNoArtifact /> :\n              !contractBilleStore ? <NoticeWrongNetwork /> :\n                eventContent\n          }\n        </div>\n      </section>\n\n\n\n\n    </main>\n  );\n}","import React from 'react';\nimport { Link } from \"react-router-dom\";\n\nimport NoticeNoArtifact from \"../NoticeNoArtifact\";\nimport NoticeWrongNetwork from \"../NoticeWrongNetwork\";\nimport useEth from \"../../contexts/EthContext/useEth\";\nimport { getDateFromTimestamp, TICKET_CATEGORIES_LABELS } from \"../../utils\";\n\nexport default function ListingTickets() {\n  const { state: { artifact, contractBilleEvent, owner, eventsCreated, ticketsSold  } } = useEth();\n  const myTickets = ticketsSold.filter (({returnValues} ) => returnValues.owner === owner);\n  const myEventIds = myTickets.map(({returnValues}) => returnValues.idEvent);\n  const myEventsInfos = eventsCreated.reduce((acc, {returnValues}) => {\n    if(myEventIds.includes(returnValues.id)) {\n      acc[returnValues.id] = {\n        ...returnValues\n      }\n    }\n    return acc;\n  }, {});\n\n  const myTicketsHeader = <section key=\"header\" className=\"py-5 text-center container\">\n      <div className=\"row py-lg-5\">\n        <div className=\"col-lg-6 col-md-8 mx-auto\">\n          <h1 className=\"fw-light\">Mes tickets</h1>\n        </div>\n      </div>\n    </section>;\n  \n  const myTicketsList =\n    myTickets.map(({ returnValues: { category, idEvent,idTicket,quantity } }) => {\n      const { eventAddress, name, description, date, uri } = myEventsInfos[idEvent];\n      const dateEve = getDateFromTimestamp(date);\n      const imageSrc = uri !== '' ? `${uri.split('//')[1]}` : '';\n\n      console.log(`🚀  imageSrc`, imageSrc);\n\n      return <div className=\"col-lg-6 p-3\" key={idTicket}>\n        <div className=\"card shadow-sm w-50\">\n          {\n            imageSrc ? <img src={`https://gateway.pinata.cloud/ipfs/${uri.split('//')[1]}`} alt=\"eventImage\"/> : <svg className=\"bd-placeholder-img card-img-top\" width=\"100%\" height=\"225\" xmlns=\"http://www.w3.org/2000/svg\" role=\"img\" aria-label=\"Placeholder: Thumbnail\" preserveAspectRatio=\"xMidYMid slice\" focusable=\"false\"><title>Placeholder</title><rect width=\"100%\" height=\"100%\" fill=\"#55595c\" /><text x=\"50%\" y=\"50%\" fill=\"#eceeef\" dy=\".3em\">Thumbnail</text></svg>\n          }\n\n          <div className=\"card-body\">\n\n            <Link to={`/events/${eventAddress}`} >\n              <p className=\"card-text\"> <strong>{name}</strong></p>\n              <p className=\"card-text\"> {description}</p>\n              <p className=\"card-text\"> <strong>Date:</strong> {dateEve}</p>\n              <p className=\"card-text\"> <strong>Nombre de tickets:</strong> {quantity}</p>\n              <p className=\"card-text\"> <strong>Catégorie</strong>: {TICKET_CATEGORIES_LABELS[category]}</p>\n            </Link>\n          </div>\n        </div>\n      </div>\n    });\n  const eventContent = [myTicketsHeader, myTicketsList ];\n\n  return (\n    <main>\n      <section className=\"py-5 text-center container\">\n        <div className=\"row\">\n          {\n            !artifact ? <NoticeNoArtifact /> :\n              !contractBilleEvent ? <NoticeWrongNetwork /> :\n                eventContent\n          }\n        </div>\n      </section>\n\n\n\n\n    </main>\n  );\n}","import React from 'react';\nimport { Link } from 'react-router-dom';\n\nexport function NavToHome() {\n  return <section className=\"py-5 text-center container\">\n    <div className=\"row py-lg-5\">\n      <div className=\"col-lg-6 col-md-8 mx-auto\">\n        <Link to=\"/events\" className=\"btn btn-sm btn-outline-secondary\">Tous les événements</Link>\n      </div>\n    </div>\n  </section>;\n}\n  ","import React, {useState} from 'react';\nimport axios from 'axios';\nimport dotenv from 'dotenv';\nimport { useForm } from \"react-hook-form\";\nimport { useNavigate } from 'react-router-dom';\n\nimport useEth from \"../../contexts/EthContext/useEth\";\nimport { NavToHome } from \"../common\";\n\ndotenv.config();\n\nexport default function FormEvent() {\n  const { state: { accounts, contractBilleStore } } = useEth();\n  const navigate = useNavigate();\n  const { register, handleSubmit } = useForm();\n  const [ isLoading, setIsLoading ] = useState(false);\n  const [ fileImg, setFileImg ] = useState(null);\n\n  const onSubmit = async data => {\n    const { nameEvent } = data;\n    \n    try {\n      setIsLoading(true);\n      \n      let uri = \"default\";\n      if(fileImg && nameEvent){\n        const cidImage = await sendFileToIPFS(nameEvent);\n        uri = cidImage;\n      }\n\n      const newData = {...data, uri};\n\n      await handleCreateEvent(newData);\n\n    } catch (err) {\n      console.log(\"Error occured\", err);\n    }finally{\n      setIsLoading(false);\n    }\n  }\n\n  const handleCreateEvent = async (params) => {\n    const { dateEvent, nameEvent, symbol, description, uri = \"default\", ticketSupply1, ticketSupply2, ticketSupply3 } = params;\n\n    try {\n      const dateTimestamp = Number(new Date(dateEvent));\n\n      await contractBilleStore.methods.createEvent(dateTimestamp, nameEvent, symbol, description, uri, [ticketSupply1, ticketSupply2, ticketSupply3]).send({ from: accounts[0] });\n      navigate('/events');\n\n    } catch (err) {\n      console.log(\"Erreur\", err);\n    }\n  }\n\n  const sendFileToIPFS = async (eventName) => {\n    const timestamp = Number(Date.now());\n    const fileName = `${fileImg.name}`;\n    const filePath = `/${timestamp}-${eventName}/${fileName}`;\n\n    if (fileImg) {\n      try {\n        const formData = new FormData();\n        formData.append(\"file\", fileImg, filePath);\n\n        const resFile = await axios({\n          method: \"post\",\n          url: \"https://api.pinata.cloud/pinning/pinFileToIPFS\",\n          data: formData,\n          headers: {\n            'pinata_api_key': `${process.env.REACT_APP_PINATA_API_KEY}`,\n            'pinata_secret_api_key': `${process.env.REACT_APP_PINATA_API_SECRET}`,\n            \"Content-Type\": \"multipart/form-data\"\n          },\n        });\n\n        const cidImage = `ipfs://${resFile.data.IpfsHash}/${fileName}`;\n        console.log(\"Image uploaded to Pinata\", cidImage);\n\n        return cidImage;\n\n      } catch (err) {\n        console.log(\"Error sending File to IPFS: \");\n        console.log(err);\n      }\n    }\n  }\n\n  return (\n    <main>\n      <section className=\"py-5 text-center container\">\n        <div className=\"row py-lg-5\">\n          <div className=\"col-lg-6 col-md-8 mx-auto\">\n            <h1 className=\"fw-light\">Ajout nouvel événement</h1>\n          </div>\n        </div>\n      </section>\n\n      <form className=\"p-3 bg-light\" onSubmit={handleSubmit(onSubmit)} >\n\n        <div className=\"mb-3 row\">\n          <label htmlFor=\"imageEvent\" className=\"col-sm-4 col-form-label\">Image événement</label>\n          <div className=\"col-sm-8\">\n            <input type=\"file\" {...register(\"imageEvent\")} onChange={(e) =>setFileImg(e.target.files[0])} />\n          </div>\n        </div>\n\n        <div className=\"mb-3 row\">\n          <label htmlFor=\"nameEvent\" className=\"col-sm-4 col-form-label\">Nom de l'événement</label>\n          <div className=\"col-sm-8\">\n            <input className=\"event-large-field\" defaultValue=\"Group's Greatest tour in Paris\" {...register(\"nameEvent\")} />\n          </div>\n        </div>\n        <div className=\"mb-3 row\">\n          <label htmlFor=\"dateEvent\" className=\"col-sm-4 col-form-label\">Date de l'évènement</label>\n          <div className=\"col-sm-8\">\n            <input defaultValue=\"2022-10-20\" type=\"date\" {...register(\"dateEvent\")} />\n          </div>\n        </div>\n        <div className=\"mb-3 row\">\n          <label htmlFor=\"symbol\" className=\"col-sm-4 col-form-label\">Monnaie</label>\n          <div className=\"col-sm-8\">\n            <input defaultValue=\"BNF\" {...register(\"symbol\")} />\n          </div>\n        </div>\n        <div className=\"mb-3 row\">\n          <label htmlFor=\"description\" className=\"col-sm-4 col-form-label\">Description</label>\n          <div className=\"col-sm-8\">\n            <input className=\"event-large-field\" defaultValue=\"La legende - once in your lifetime !\" {...register(\"description\")} />\n          </div>\n        </div>\n        <div className=\"mb-3 row\">\n          <label htmlFor=\"ticketSupplies1\" className=\"col-sm-4 col-form-label\">Nombre de tickets Pelouse</label>\n          <div className=\"col-sm-8\">\n            <input type=\"number\" className=\"text-end\" defaultValue={50} {...register(\"ticketSupply1\")} />\n          </div>\n        </div>\n        <div className=\"mb-3 row\">\n          <label htmlFor=\"ticketSupplies2\" className=\"col-sm-4 col-form-label\">Nombre de tickets Gradin</label>\n          <div className=\"col-sm-8\">\n            <input type=\"number\" className=\"text-end\" defaultValue={30} {...register(\"ticketSupply2\")} />\n          </div>\n        </div>\n        <div className=\"mb-3 row\">\n          <label htmlFor=\"ticketSupplies2\" className=\"col-sm-4 col-form-label\">Nombre de tickets VIP</label>\n          <div className=\"col-sm-8\">\n            <input type=\"number\" className=\"text-end\" defaultValue={10} {...register(\"ticketSupply3\")} />\n          </div>\n        </div>\n\n        <div className=\"mb-3 row container text-center\">\n          <div className=\"col\">\n            <button className=\"btn btn-primary\" type=\"submit\" >{\n              isLoading ? <div className=\"spinner-border text-warning\" role=\"status\">\n              <span className=\"visually-hidden\">Loading...</span>\n            </div> : \"Envoyer\"\n            }</button>\n          </div>\n        </div>\n\n      </form>\n\n      {<NavToHome />}\n\n    </main>\n  );\n\n}","import React, { useState, useEffect } from 'react';\nimport { Link, useParams } from \"react-router-dom\";\n\nimport {\n  getContractEventByAddress, \n  getDateFromTimestamp,\n  isOwner,\n  formatAmount,\n  TICKET_CATEGORIES,\n  TICKET_CATEGORIES_LABELS,\n  TICKET_PRICE } from \"../../utils\";\nimport useEth from \"../../contexts/EthContext/useEth\";\nimport { actions } from \"../../contexts/EthContext/state\";\n\nexport default function ViewEvent() {\n  const { state: { web3, accounts, owner, eventsCreated, ticketsSold, handleDispatch } } = useEth();\n  const [contractBilleEvent, setContractBilleEvent] = useState(null);\n  const [stats, setStats] = useState( { balance: formatAmount('0', web3), ticketsStats: ['0', '0', '0', '0', '0', '0', '0'] });\n\n  const { id } = useParams();\n  const isAdmin = isOwner(accounts, owner);\n  const showEventStats = contractBilleEvent && isAdmin;\n\n  useEffect(() => {\n    if (web3 && (!contractBilleEvent)) {\n      const contractEvent = getContractEventByAddress(web3, id);\n      setContractBilleEvent(contractEvent);\n    }\n  }, [web3, contractBilleEvent, id]);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      const ticketsStatsObject = await contractBilleEvent.methods.getEventStats().call({ from: accounts[0] });\n      const ticketsStats = Object.values(ticketsStatsObject);\n      const balance = `${ticketsStats.slice(-1)[0]}`;\n\n      const options = { fromBlock: 0, toBlock: 'latest' };\n      const [tickets] = await contractBilleEvent.getPastEvents('TicketSold', options);\n      setStats(stats => ({ ...stats, balance: formatAmount(balance, web3), ticketsStats }));\n\n      handleDispatch({type: actions.TICKET_SOLD, data: { evTicketSold: tickets }});\n    }\n\n    if (isAdmin && contractBilleEvent) {\n      fetchData();\n    }\n  }, [web3, accounts, contractBilleEvent, isAdmin, handleDispatch]);\n\n  let eventInfos = { date: '', description: '', eventAddress: '', name: '', uri: '' }, eventStats, eventStatsTickets;\n  const [currentEvent] = eventsCreated.filter(({ returnValues: { eventAddress } }) => eventAddress === id);\n\n  if (currentEvent) {\n    const { returnValues: { date, description, eventAddress, name, uri } } = currentEvent;\n    eventInfos = { date: getDateFromTimestamp(date), description, eventAddress, name, uri };\n    \n    // Stats sales / supply by Ticket category\n    eventStatsTickets = TICKET_CATEGORIES.map(i => {\n        return (<div key={i} className=\"row mb-3\">\n          <label htmlFor=\"colFormLabel\" className=\"col-sm-3 col-form-label\">Tickets {`${TICKET_CATEGORIES_LABELS[i]}`}</label>\n          <div className=\"col-sm-9\">\n            <input type=\"text\" className=\"form-control w-50 text-end\" id=\"colFormLabel\" placeholder=\"col-form-label\" value={`${stats.ticketsStats[i]} / ${stats.ticketsStats[i+3]}`} disabled />\n          </div>\n        </div>\n      );\n    })\n\n    // Stats balance\n    eventStats = <section className=\"event-view container py-5 bg-light\">\n      <h5 className=\"fw-light\">Admin - Event stats</h5>\n      <div className=\"row mb-3\">\n          <label htmlFor=\"colFormLabelSm\" className=\"col-sm-3 col-form-label col-form-label\">Balance</label>\n          <div className=\"col-sm-9\">\n            <input type=\"text\" className=\"form-control w-50  text-end\" id=\"colFormLabelSm\" placeholder=\"col-form-label\" value={stats.balance} disabled />\n          </div>\n      </div>\n      {eventStatsTickets}\n    </section>;\n  }\n\n  return (\n    <main>\n      <section className=\"py-5 text-center container\">\n        <div className=\"row py-lg-5\">\n          <div className=\"col-lg-6 col-md-8 mx-auto\">\n            <h1 className=\"fw-light\">Détails événement</h1>\n            <p className=\"lead text-muted\">\n              <Link type=\"button\" className=\"btn btn-primary\" to={`/events/${id}/buyticket`}>J'y vais</Link>\n            </p>\n          </div>\n        </div>\n      </section>\n\n      <div className=\"event-view container p-3 bg-light\">\n      <div className=\"row mb-3\">\n          <label htmlFor=\"colFormLabel\" className=\"col-sm-3 col-form-label\">Name</label>\n          <div className=\"col-sm-9\">\n            <input type=\"text\" className=\"form-control event-large-field\" id=\"colFormLabel\" placeholder=\"col-form-label\" value={eventInfos.name} disabled />\n          </div>\n        </div>\n        <div className=\"row mb-3\">\n          <label htmlFor=\"colFormLabelLg\" className=\"col-sm-3 col-form-label col-form-label\">Description</label>\n          <div className=\"col-sm-9\">\n            <input type=\"text\" className=\"form-control event-large-field\" id=\"colFormLabelLg\" placeholder=\"col-form-label\" value={eventInfos.description} disabled />\n          </div>\n        </div>\n        <div className=\"row mb-3\">\n          <label htmlFor=\"colFormLabelSm\" className=\"col-sm-3 col-form-label col-form-label\">Date</label>\n          <div className=\"col-sm-9\">\n            <input type=\"text\" className=\"form-control w-25\" id=\"colFormLabelSm\" placeholder=\"col-form-label\" value={eventInfos.date} disabled />\n          </div>\n        </div>\n        <div className=\"row mb-3\">\n          <label htmlFor=\"ticketPrice\" className=\"col-sm-3 col-form-label col-form-label\">Ticket price</label>\n          <div className=\"col-sm-9\">\n            <input type=\"text\" className=\"form-control w-25\" id=\"ticketPrice\" placeholder=\"col-form-label\" value={`${TICKET_PRICE} Eth`} disabled />\n          </div>\n        </div>\n      </div>\n      <br/>\n      {\n        showEventStats && eventStats\n      }\n      <section className=\"py-5 text-center container\">\n        <div className=\"row py-lg-5\">\n          <div className=\"col-lg-6 col-md-8 mx-auto\">\n            <Link to=\"/\" className=\"btn btn-sm btn-outline-secondary\">Tous les événements</Link>\n          </div>\n        </div>\n      </section>\n    </main>\n  );\n}","import React, { useState, useEffect } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport Joi from 'joi';\n\nimport { getContractEventByAddress, isOwner, formatAmount, TICKET_PRICE } from \"../../utils\";\nimport useEth from \"../../contexts/EthContext/useEth\";\n\nexport default function FormEvent() {\n  const { state: { web3, accounts, owner } } = useEth();\n  \n  const navigate = useNavigate();\n  let {id} = useParams();\n  \n  const [isLoading, setIsLoading] = useState(false);\n  const [contractBilleEvent, setContractBilleEvent] = useState(null);\n\n  //error list from joi validation\n  const [errlist, setErrlist] = useState([]);\n  // error message from Api request\n  const [errMessage, setErrMessage] = useState('');\n\n  const [ticketOrder , setTicketOrder] = useState({\n    category: 0,\n    quantity: 1\n  });\n\n  const isAdmin = isOwner(accounts, owner);\n\n  useEffect(() => {\n    const fetchData = async(tmp) => {\n      if(tmp){\n        console.log(`🚀 balance Contrat ${id}`, await tmp.methods.getBalance().call({from: accounts[0]}));\n      }\n    }\n\n    if (web3 && id) {\n      const tmp = getContractEventByAddress(web3, id);\n      setContractBilleEvent(tmp);\n\n      if (isAdmin) {\n        fetchData(tmp);\n      }\n    }\n  }, [web3, accounts, id, isAdmin]);\n\n  const handleChange = (e) => {\n    let inputValue = e.target.value;\n    let addedTicketOrder = { ...ticketOrder };\n\n    if(e.target.name)\n      addedTicketOrder[e.target.name] = parseInt(inputValue, 10);\n    else\n      addedTicketOrder[e.target.id] = inputValue;\n\n    setTicketOrder(addedTicketOrder);\n  }\n\n  const handleTicketBuy = async () => {\n    const {category, quantity}= ticketOrder;\n\n    if (contractBilleEvent) {\n      const price = web3.utils.toWei(`${TICKET_PRICE}`, 'ether') * quantity;\n\n      try {\n        setIsLoading(true);\n        await contractBilleEvent.methods.buyTickets(category, quantity).send({ from: accounts[0], gas: 3000000, value: price });\n\n        navigate(`/events/${id}`);\n\n      }catch(err) {\n        console.log(`handleTicketBuy: Error `, err);\n        setErrMessage(\"Une erreur est survenue. Essayez ultérieurement.\");\n      }finally {\n        setIsLoading(false);\n      }\n    }else {\n      setErrMessage(\"Une erreur est survenue. Essayez ultérieurement\");\n    }\n  };\n\n  const handleSubmit = async(e) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const schema = Joi.object({\n      category: Joi.number().min(0).max(2).required(),\n      quantity: Joi.number().min(1).max(4).required()\n    });\n\n    const joiResponse = schema.validate( ticketOrder  , { abortEarly: false});\n\n    if(joiResponse.error){\n      setErrlist(joiResponse.error.details);\n    }else{\n      setErrlist([]);\n\n      //call Api\n      await handleTicketBuy();\n    }\n    \n  };\n  \n  const totalPrice = web3 ? formatAmount(`${web3.utils.toWei(`${TICKET_PRICE}`, 'ether') * ticketOrder.quantity}`, web3) : '0 Eth';\n\n  return(\n    <main>\n      <section className=\"py-5 text-center container\">\n        <div className=\"row py-lg-5\">\n          <div className=\"col-lg-6 col-md-8 mx-auto\">\n            <h1 className=\"fw-light\">Achetez vos tickets</h1>\n            {/* <p className=\"lead text-muted\">Something short and leading about the collection below—its contents, the creator, etc. Make it short and sweet, but not too short so folks don’t simply skip over it entirely.</p> */}\n          </div>\n        </div>\n      </section>\n\n      <form className=\"p-3 bg-light\" onSubmit={handleSubmit}>\n        {\n          errMessage.length ? <div className='alert alert-danger py-1'> {errMessage} </div> : \"\"\n        }\n        {\n          errlist.length ? errlist.map((err,i) => <div key={i} className='alert alert-danger py-1' role=\"alert\"> {err.message}</div>): \"\"\n        }\n        <div className=\"mb-3 row\">\n          <label forhtml=\"category\" className=\"col-sm-4 col-form-label\">Catégorie</label>\n          <div className=\"col-sm-8\">\n            <div className=\"form-check form-check-inline\">\n              <input className=\"form-check-input\" type=\"radio\" name=\"category\" id=\"category1\" value=\"0\" onChange={handleChange} checked={ticketOrder.category === 0} disabled={isLoading} />\n              <label className=\"form-check-label\" forhtml=\"inlineRadio1\">Fosse</label>\n            </div>\n            <div className=\"form-check form-check-inline\">\n              <input className=\"form-check-input\" type=\"radio\" name=\"category\" id=\"category2\" value=\"1\" onChange={handleChange}  checked={ticketOrder.category === 1} disabled={isLoading} />\n              <label className=\"form-check-label\" forhtml=\"inlineRadio2\">Gradins</label>\n            </div>\n            <div className=\"form-check form-check-inline\">\n              <input className=\"form-check-input\" type=\"radio\" name=\"category\" id=\"category3\" value=\"2\" onChange={handleChange}  checked={ticketOrder.category === 2} disabled={isLoading} />\n              <label className=\"form-check-label\" forhtml=\"inlineRadio3\">VIP</label>\n            </div>\n          </div>\n        </div>\n        <div className=\"mb-3 row\">\n          <label htmlFor=\"ticketNumber\" className=\"col-sm-4 form-label\">Nombre de tickets:</label>\n          <div className=\"col-sm-8\">\n            <input type=\"number\" className=\"form-control w-50\" id=\"quantity\" min={1} max={4} onChange={handleChange} defaultValue={1} disabled={isLoading} />\n          </div>\n        </div>\n        <div className=\"mb-3 row\">\n          <label htmlFor=\"totalPrice\" className=\"col-sm-4 form-label\">Total price:</label>\n          <div className=\"col-sm-8\">\n            <input type=\"text\" className=\"form-control w-50\" id=\"totalPrice\" value={totalPrice} disabled />\n          </div>\n        </div>\n\n        <div className=\"mb-3 row container text-center\">\n          <div className=\"col\">\n            <button type=\"submit\" className=\"btn btn-primary\" disabled={isLoading}>{\n              isLoading ? <div className=\"spinner-border text-warning\" role=\"status\">\n              <span className=\"visually-hidden\">Loading...</span>\n            </div> : \"J'achète\"\n            }</button>\n          </div>\n        </div>\n      </form>\n    </main>\n  );\n}\n","import { Link } from \"react-router-dom\";\n\nexport default function NoMatch() {\n  return (\n    <main>\n      <section className=\"py-5 text-center container\">\n        <div className=\"row py-lg-5\">\n          <div className=\"col-lg-6 col-md-8 mx-auto\">\n            <h2>It looks like you're lost...</h2>\n            <p className=\"lead text-muted\">\n              <Link to=\"/\">Go to the home page</Link>\n            </p>\n          </div>\n        </div>\n      </section>\n    </main>\n  );\n}","import { Outlet, useRoutes } from \"react-router-dom\";\n\nimport { EthProvider } from \"./contexts/EthContext\";\nimport Navbar from \"./components/Navbar\";\nimport Menu from \"./components/Menu\";\nimport Listing from \"./components/Listing\";\nimport ListingTickets from \"./components/ListingTickets\";\nimport FormEvent from \"./components/FormEvent\";\nimport ViewEvent from \"./components/ViewEvent\";\nimport FormTicket from \"./components/FormTicket\";\nimport NoMatch from \"./components/NoMatch\";\nimport \"./App.css\";\n\nexport default function App() {\n  let routes = [\n    {\n      path: \"/\",\n      element: <Layout />,\n      children: [\n        { \n            index: true, element: <Listing />,\n        },\n        {\n          path: \"/events\",\n          children: [\n            {\n              path: \"/events/:id/buyticket\",\n              element: <FormTicket />,\n            },\n            {\n              path: \"/events/:id\",\n              element: <ViewEvent />\n            },\n            {\n              path: \"/events/add\",\n              element: <FormEvent />\n            },\n          ]\n        },\n        {\n          path: \"/mytickets\",\n          element: <ListingTickets />\n        },\n        { path: \"*\", element: <NoMatch /> },\n      ],\n    },\n  ];\n  let element = useRoutes(routes);\n\n  return (\n    <EthProvider>\n      {element}\n    </EthProvider>\n  );\n}\n\n\nfunction Layout() {\n  return (\n    <>\n      <Navbar />\n      <Menu />\n      <Outlet />\n    </>\n  );\n}","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport { HashRouter } from \"react-router-dom\";\nimport './index.css';\nimport App from './App';\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(\n  <React.StrictMode>\n    <HashRouter>\n      <App />\n    </HashRouter>\n  </React.StrictMode>\n);\n"],"sourceRoot":""}